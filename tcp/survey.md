要理解互联网需要理解互联网协议protocol
应用层->传输层->网络层->链路层->物理设备

### 物理层
连接多个电脑,例如缆、电缆、双绞线、无线电波,负责传送0和1的电信号
总结:物理设备的作用是传输0,1电信号

### 链路层
以太网 
单纯的0和1没有任何意义，必须规定解读方式：多少个电信号算一组？每个信号位有何意义？  
这就是"链接层"的功能，它在"实体层"的上方，确定了0和1的分组方式。  
一组电信号构成一个数据包,叫做帧,帧包括两部分(head,data)  
"标头"的长度，固定为18字节。"数据"的长度，最短为46字节，最长为1500字节。因此，整个"帧"最短为64字节，最长为1518字节。如果数据很长，就必须分割成多个帧进行发送。
通过mac寻址,mac是独一无二的,mac地址即网卡的地址
总结:物理设备传输的0,1没有意义,把0,1分组,每一组就是一个数据包(帧) ,电脑要接收数据就必须知道网卡的地址(即mac地址)

#### 就算有了MAC地址，系统怎样才能把数据包准确送到接收方？
以太网采用了一种很"原始"的方式，它不是把数据包准确送到接收方，而是向本网络内所有计算机发送，让每台计算机自己判断，是否为接收方。  
但这样做有一个重大的缺点。以太网采用广播方式发送数据包，所有成员人手一"包"，不仅效率低，所以只局限于局域网

### 网络层
无法区分哪些MAC地址属于同一个子网络，哪些不是。如果是同一个子网络，就采用广播方式发送，否则就采用"路由"方式发送,所以诞生了网络层  
网络地址帮助我们确定计算机所在的子网络，MAC地址则将数据包送到该子网络中的目标网卡。因此，从逻辑上可以推断，必定是先处理网络地址，然后再处理MAC地址。  

#### ip地址
ip地址由两部分组成,包括网络部分和主机部分,网络部分不固定,可能是16位,24位等等,处于同一个子网络的电脑,网络部分是一样的

##### 子网掩码
因为网络部分不固定,所以需要借助于子网掩码
知道"子网掩码"，我们就能判断，任意两个IP地址是否处在同一个子网络。方法是将两个IP地址与子网掩码分别进行AND运算（两个数位都为1，运算结果为1，否则为0），
然后比较结果是否相同，如果是的话，就表明它们在同一个子网络中，否则就不是。  
如已知IP地址172.16.254.1和172.16.254.233的子网掩码都是255.255.255.0，请问它们是否在同一个子网络？两者与子网掩码分别进行AND运算，
结果都是172.16.254.0，因此它们在同一个子网络。

ip协议的作用主要有两个，一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络。
每台计算机有两个地址:mac地址和IP地址

#### ip数据包
IP数据包的"标头"部分的长度为20到60字节，整个数据包的总长度最大为65,535字节。因此，理论上，一个IP数据包的"数据"部分，最长为65,515字节。前面说过，以太
网数据包的"数据"部分，最长只有1500字节。因此，如果IP数据包超过了1500字节，它就需要分割成几个以太网数据包，分开发送了。  
HTTP/2 协议的一大改进， 就是压缩 HTTP 协议的头信息，使得一个 HTTP 请求可以放在一个 TCP 数据包里面，而不是分成多个，这样就提高了速度

1）第一种情况：如果两台主机不在同一个子网络，那么事实上没有办法得到对方的MAC地址，只能把数据包传送到两个子网络连接处的"网关"（gateway），让网关去处理；  
2）第二种情况：如果两台主机在同一个子网络，那么我们可以用ARP协议，得到对方的MAC地址。ARP协议也是发出一个数据包（包含在以太网数据包中），其中包含它所要查询主机的IP地址，在对方的MAC地址这一栏，填的是FF:FF:FF:FF:FF:FF，表示这是一个"广播"地址。它所在子网络的每一台主机，都会收到这个数据包，从中取出IP地址，与自身的IP地址进行比较。如果两者相同，都做出回复，向对方报告自己的MAC地址，否则就丢弃这个包。  

总结:  
- 网络层是在不同局域网中,通过ip->mac找到对方计算机    
- 路由器就是基于 IP 协议。局域网之间要靠路由器连接  


### 传输层
"传输层"的功能，就是建立"端口到端口"的通信。相比之下，"网络层"的功能是建立"主机到主机"的通信。只要确定主机和端口，我们就能实现程序之间的交流。因此，Unix系统就把主机+端口，叫做"套接字"（socket）。有了它，就可以进行网络应用程序开发了。  
TCP数据包和UDP数据包一样，都是内嵌在IP数据包的"数据"部分。TCP数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常TCP数据包的长度不会超过IP数据包的长度，以确保单个TCP数据包不必再分割。  
UDP数据包非常简单，"标头"部分一共只有8个字节，总长度不超过65,535字节，正好放进一个IP数据包。  
操作系统不会去处理 TCP 数据包里面的数据。一旦组装好 TCP 数据包，就把它们转交给应用程序。TCP 数据包里面有一个端口（port）参数，就是用来指定转交给监听该端口的应用程序。  

每个 ACK 都带有下一个数据包的编号，以及接收窗口的剩余容量，双方都会发送 ACK

### 应用层
TCP协议可以为各种各样的程序传递数据，比如Email、WWW、FTP等等。那么，必须有不同协议规定电子邮件、网页、FTP数据的格式，这些应用程序协议就构成了"应用层"。这是最高的一层，直接面对用户。它的数据就放在TCP数据包的"数据"部分。

![](http://www.52im.net/data/attachment/forum/201811/01/151016iaeia7apeacny25l.jpg)

### 上网设置
所谓"动态IP地址"，指计算机开机后，会自动分配到一个IP地址，不用人为设定。它使用的协议叫做DHCP协议,它是一种应用层协议，建立在UDP协议之上    

这个协议规定，每一个子网络中，有一台计算机负责管理本网络的所有IP地址，它叫做"DHCP服务器"。新的计算机加入网络，必须向"DHCP服务器"发送一个"DHCP请求"数据包，申请IP地址和相关的网络参数。  
 
当看到发出方IP地址是0.0.0.0，接收方是255.255.255.255，于是DHCP服务器知道"这个包是发给我的"，而其他计算机就可以丢弃这个包。  

### DHCP服务器
负责管理本网络所有IP地址

### DNS
DNS协议将网址转换成IP地址


### 总结
- (应用层)应用层协议,如http
- (传输层)TCP协议,保证数据通信的完整性和可靠性，防止丢包
- (网络层)ip协议,定义了自己地址规则,能够找到另一个局域网的计算机,解决了不同局域网通信问题
- (链路层)以太网协议,规定了电信号如何组成数据包(帧),解决了同个局域网点不点通信问题

![](http://www.52im.net/data/attachment/forum/201710/12/152452wiu9zugudg58502r.jpg)
